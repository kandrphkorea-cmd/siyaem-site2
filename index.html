<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SiyaEm Korea ‚Äî —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –ö–æ—Ä–µ–µ</title>
<style>
  :root{
    --bg:#0f172a;           /* —Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
    --bg-2:#0b132b;
    --card:#111827;         /* –∫–∞—Ä—Ç–æ—á–∫–∏ */
    --stroke:#1f2937;       /* –ª–∏–Ω–∏–∏ */
    --text:#e5e7eb;         /* –±–µ–ª—ã–π –º—è–≥–∫–∏–π */
    --muted:#9ca3af;
    --accent:#2563eb;       /* –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π —Å–∏–Ω–∏–π */
    --accent-2:#60a5fa;
    --gold:#fbbf24;         /* –¥–ª—è –∑–≤—ë–∑–¥ */
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--text);
    background:linear-gradient(180deg,var(--bg-2),var(--bg) 35% 65%,#0c1224);
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  .wrap{max-width:1200px;margin:0 auto;padding:20px}
  header{
    position:sticky; top:0; z-index:20;
    background:rgba(15,23,42,.65); backdrop-filter: blur(12px);
    border-bottom:1px solid var(--stroke);
  }
  .nav{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 0}
  .brand{display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.3px; font-size:18px}
  .brand .dot{width:10px;height:10px;border-radius:50%;background:#fbbf24;box-shadow:0 0 16px #fbbf24}
  .menu{display:flex; gap:8px; flex-wrap:wrap}
  .menu a{
    text-decoration:none; color:var(--text); opacity:.85; padding:10px 14px; border-radius:12px;
    border:1px solid transparent; transition:.2s; font-weight:700;
  }
  .menu a:hover{border-color:#2f467a; color:#dbeafe}

  /* Hero –ø–∞–Ω–µ–ª—å –∫–∞–∫ —É –∞–≤–∏–∞—Å–µ–π–ª—Å */
  .hero{
    margin:26px 0 16px; border:1px solid var(--stroke); border-radius:var(--radius);
    background:rgba(17,24,39,.75); padding:22px;
  }
  .hero h1{margin:0 0 8px; font-size:40px; font-weight:900; letter-spacing:.2px}
  .hero p{margin:0; color:var(--muted); font-size:16px}

  /* –í–∫–ª–∞–¥–∫–∏ */
  .tabs{display:flex; gap:10px; margin-top:18px; flex-wrap:wrap}
  .tab{
    background:#0b1221; border:1px solid #1f2a44; color:#cfe2ff;
    padding:12px 16px; border-radius:14px; font-weight:800; font-size:15px; cursor:pointer; transition:.2s;
  }
  .tab.active, .tab:hover{border-color:#3256b8; background:#0f1d3f; color:#ffffff}

  /* –ü–æ–∏—Å–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
  .search{
    margin-top:14px; display:grid; grid-template-columns: 2fr 2fr 2fr 1fr;
    gap:10px; align-items:stretch;
  }
  .field{
    background:#0b1221; border:1px solid var(--stroke); border-radius:14px; padding:10px 12px; display:flex; flex-direction:column; gap:6px
  }
  .field label{font-size:12px; color:#9fb0c7}
  .field select, .field input{
    width:100%; border:none; outline:none; background:transparent; color:var(--text); font-size:16px; font-weight:700
  }
  .btn{appearance:none; border:none; cursor:pointer; padding:12px 16px; border-radius:14px; font-weight:900; font-size:16px}
  .btn-primary{background:var(--accent); color:#fff}
  .btn-primary:hover{filter:brightness(1.06)}
  .btn-ghost{background:transparent; color:#cfe2ff; border:1px solid #2b3f72}
  .btn-ghost:hover{border-color:#3b57a2}

  /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
  .results{margin-top:18px; display:grid; grid-template-columns:repeat(3, 1fr); gap:12px}
  @media (max-width:980px){ .results{grid-template-columns:1fr 1fr} }
  @media (max-width:640px){ .results{grid-template-columns:1fr} .search{grid-template-columns:1fr} }
  .card{
    background:rgba(17,24,39,.85); border:1px solid var(--stroke); border-radius:16px; padding:14px
  }
  .card h3{margin:0 0 6px; font-size:18px}
  .card small{color:#9fb0c7}
  .stars{display:inline-flex; gap:2px; margin-top:6px}
  .star{color:#475569; font-size:18px}
  .star.on{color:var(--gold)}

  .hr{height:1px; background:var(--stroke); margin:18px 0}

  /* –ú–æ–¥–∞–ª–∫–∞ –∫–∞—Ä—Ç—ã */
  .modal{position:fixed; inset:0; display:none; place-items:center; z-index:50; background:rgba(2,6,23,.65); backdrop-filter: blur(6px)}
  .modal.show{display:grid}
  .box{width:min(1100px, calc(100vw - 28px)); background:var(--card); border:1px solid var(--stroke); border-radius:18px; padding:16px}
  #map{height:580px; border-radius:12px; overflow:hidden}
</style>
</head>
<body>
<header>
  <div class="wrap nav">
    <div class="brand"><span class="dot"></span><span>SiyaEm Korea</span></div>
    <nav class="menu">
      <a href="#" onclick="openAbout();return false;">–û –∫–æ–º–ø–∞–Ω–∏–∏</a>
      <a href="#" onclick="openInvest();return false;">–ò–Ω–≤–µ—Å—Ç–æ—Ä–∞–º</a>
      <a href="#" onclick="openSupport();return false;">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="hero">
    <h1>–¢—É—Ç –Ω–∞—Ö–æ–¥—è—Ç —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –ö–æ—Ä–µ–µ</h1>
    <p>–ü–∞—Ä—Ç–Ω—ë—Ä—ã —Å –ª–∏—Ü–µ–Ω–∑–∏–µ–π. –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏. –í—ã–±–∏—Ä–∞–π –ø—Ä–æ–≤–∏–Ω—Ü–∏—é, –≥–æ—Ä–æ–¥ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Äî –∏ —Å–º–æ—Ç—Ä–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</p>

    <div class="tabs" id="tabs">
      <button class="tab active" data-cat="">–í—Å–µ</button>
      <button class="tab" data-cat="–ï–¥–∞">üçú –ï–¥–∞</button>
      <button class="tab" data-cat="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">üéØ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</button>
      <button class="tab" data-cat="–°–∞–ª–æ–Ω—ã">üíÖ –°–∞–ª–æ–Ω—ã</button>
      <button class="tab" data-cat="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöñ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</button>
    </div>

    <div class="search">
      <div class="field">
        <label>–ü—Ä–æ–≤–∏–Ω—Ü–∏—è</label>
        <select id="provinceSelect"><option value="">–õ—é–±–∞—è</option></select>
      </div>
      <div class="field">
        <label>–ì–æ—Ä–æ–¥</label>
        <select id="citySelect"><option value="">–õ—é–±–æ–π</option></select>
      </div>
      <div class="field">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="categorySelect">
          <option value="">–õ—é–±–∞—è</option>
          <option>–ï–¥–∞</option>
          <option>–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
          <option>–°–∞–ª–æ–Ω—ã</option>
          <option>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
        </select>
      </div>
      <button class="btn btn-primary" id="btnSearch">–ù–∞–π—Ç–∏</button>
    </div>

    <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap">
      <button class="btn btn-ghost" id="btnShowMap">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</button>
      <button class="btn btn-ghost" onclick="openPartner()">–°—Ç–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º</button>
    </div>
  </section>

  <div class="results" id="results"></div>
  <div class="hr"></div>
  <p style="opacity:.8">–°–æ–≤–µ—Ç: –æ—Ç–∫—Ä–æ–π ¬´–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ¬ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ. –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ —Ç–≤–æ–µ–º—É –∑–∞–ø—Ä–æ—Å—É ‚Äî —ç–∫–æ–Ω–æ–º–∏–º —Ç—Ä–∞—Ñ–∏–∫ –∏ —É—Å–∫–æ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É.</p>
</main>

<!-- –ú–æ–¥–∞–ª–∫–∞ –∫–∞—Ä—Ç—ã -->
<div class="modal" id="mapModal">
  <div class="box">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
      <strong>–ö–∞—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</strong>
      <div>
        <button class="btn btn-ghost" onclick="closeMap()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
    <div id="map"></div>
  </div>
</div>

<script>
  // ======= –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ =======
  const state = {
    partners: [],
    filtered: [],
    currentTab: "",      // –∞–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è)
    province: "",
    city: "",
    category: ""
  };

  const els = {
    province: document.getElementById('provinceSelect'),
    city: document.getElementById('citySelect'),
    category: document.getElementById('categorySelect'),
    results: document.getElementById('results'),
    tabs: document.getElementById('tabs'),
    btnSearch: document.getElementById('btnSearch'),
    btnMap: document.getElementById('btnShowMap'),
    mapModal: document.getElementById('mapModal')
  };

  // ======= –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è =======
  init();
  async function init(){
    // –≥—Ä—É–∑–∏–º –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
    try{
      const res = await fetch('partners.json', {cache:'no-cache'});
      state.partners = await res.json();
    }catch(e){
      console.error('partners.json –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –ø—É—Å—Ç:', e);
      state.partners = [];
    }

    // populate selects
    const provinces = [...new Set(state.partners.map(p=>p.province_ru).filter(Boolean))].sort();
    provinces.forEach(p=>{
      const o = document.createElement('option'); o.value=o.textContent=p; els.province.appendChild(o);
    });

    els.province.addEventListener('change', ()=>{
      state.province = els.province.value;
      rebuildCityOptions();
    });
    els.city.addEventListener('change', ()=>{ state.city = els.city.value; });
    els.category.addEventListener('change', ()=>{ state.category = els.category.value; });

    // –≤–∫–ª–∞–¥–∫–∏
    els.tabs.addEventListener('click', (e)=>{
      const b = e.target.closest('.tab'); if(!b) return;
      els.tabs.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      state.currentTab = b.dataset.cat || "";
      runSearch(); 
    });

    // –∫–Ω–æ–ø–∫–∏
    els.btnSearch.onclick = runSearch;
    els.btnMap.onclick = openMap;

    // –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤)
    runSearch();
  }

  function rebuildCityOptions(){
    els.city.innerHTML = '<option value="">–õ—é–±–æ–π</option>';
    let pool = state.partners;
    if(state.province) pool = pool.filter(p=>p.province_ru===state.province);
    const cities = [...new Set(pool.map(p=>p.city_ru).filter(Boolean))].sort();
    cities.forEach(c=>{
      const o = document.createElement('option'); o.value=o.textContent=c; els.city.appendChild(o);
    });
  }

  // ======= –ü–æ–∏—Å–∫/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è =======
  function runSearch(){
    let arr = [...state.partners];
    if(state.currentTab) arr = arr.filter(p=>p.category===state.currentTab);
    if(state.category)   arr = arr.filter(p=>p.category===state.category);
    if(state.province)   arr = arr.filter(p=>p.province_ru===state.province);
    if(state.city)       arr = arr.filter(p=>p.city_ru===state.city);
    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã–µ
    arr = arr.filter(p=>p.approved===true);

    state.filtered = arr;
    renderResults(arr);
  }

  // ======= –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ =======
  function renderResults(list){
    els.results.innerHTML = '';
    if(list.length===0){
      els.results.innerHTML = '<div class="card" style="grid-column:1/-1">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã.</div>';
      return;
    }
    list.forEach(p=>{
      const card = document.createElement('div');
      card.className='card';
      card.innerHTML = `
        <h3>${escapeHtml(p.name||'–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</h3>
        <small>${escapeHtml(p.province_ru||'‚Äî')}${p.city_ru?(' ‚Ä¢ '+escapeHtml(p.city_ru)):""}</small>
        <div class="stars">${buildStars(p.rating)}</div>
        <div style="margin-top:8px">${escapeHtml(p.address||'')}</div>
        <div style="display:flex; gap:8px; margin-top:10px; flex-wrap:wrap">
          <button class="btn btn-primary" onclick='focusOnMap(${p.lat||0}, ${p.lng||0}, ${JSON.stringify(p).replaceAll("'","&#39;")})'>–ù–∞ –∫–∞—Ä—Ç–µ</button>
          <button class="btn btn-ghost" onclick='openPartner()'>–°—Ç–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º</button>
        </div>
      `;
      els.results.appendChild(card);
    });
  }

  function buildStars(r){
    const v = Number(r)||0; let html='';
    for(let i=1;i<=5;i++){
      html += `<span class="star ${i<=Math.round(v)?'on':''}">‚òÖ</span>`;
    }
    return html;
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
  }

  // ======= –ú–æ–¥–∞–ª–∫–∞ –∫–∞—Ä—Ç—ã –∏ –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ Google Maps =======
  let gMap, gMarkers=[];
  async function openMap(){
    els.mapModal.classList.add('show');
    if(!window.google || !window.google.maps){
      await loadGoogleMaps();  // –ø–æ–¥–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
    }
    setTimeout(initOrUpdateMap, 0);
  }
  function closeMap(){ els.mapModal.classList.remove('show'); }

  async function loadGoogleMaps(){
    const KEY = 'AIzaSyBfroP4Q7_yFpEMPXgDMn-bohk1xRxTkro'; /* ‚Üê –í–°–¢–ê–í–¨ –°–í–û–ô –ö–õ–Æ–ß */
    const url = `https://maps.googleapis.com/maps/api/js?key=${KEY}&callback=__gmInit`;
    await new Promise((resolve)=>{
      window.__gmInit = ()=>resolve();
      const s = document.createElement('script');
      s.src = url; s.async = true; document.head.appendChild(s);
    });
  }

  function initOrUpdateMap(){
    const target = document.getElementById('map');
    if(!gMap){
      gMap = new google.maps.Map(target,{
        center:{lat:36.9305, lng:127.0458}, zoom: 12,
        styles: [
          { featureType: "poi", stylers:[{visibility:"off"}] },
          { featureType: "poi.business", stylers:[{visibility:"off"}] },
          { featureType: "poi.attraction", stylers:[{visibility:"off"}] },
          { featureType: "poi.medical", stylers:[{visibility:"off"}] },
          { featureType: "poi.government", stylers:[{visibility:"off"}] },
          { featureType: "poi.school", stylers:[{visibility:"off"}] },
          { featureType: "poi.sports_complex", stylers:[{visibility:"off"}] }
        ],
        mapTypeControl:false, streetViewControl:false, fullscreenControl:true
      });
    }
    // –ø–æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–∞—Ä–∫–µ—Ä—ã
    gMarkers.forEach(m=>m.setMap(null)); gMarkers=[];

    const bounds = new google.maps.LatLngBounds();
    (state.filtered.length?state.filtered:state.partners.filter(p=>p.approved)).forEach(p=>{
      if(!(p.lat&&p.lng)) return;
      const m = new google.maps.Marker({
        position:{lat:p.lat, lng:p.lng}, map:gMap, title: p.name || ''
      });
      const iw = new google.maps.InfoWindow({content: `
        <div style="max-width:240px">
          <strong>${escapeHtml(p.name||'')}</strong><br/>
          <small>${escapeHtml(p.province_ru||'')}${p.city_ru?(' ‚Ä¢ '+escapeHtml(p.city_ru)):""}</small><br/>
          <div class="stars" style="margin-top:6px">${buildStars(p.rating)}</div>
          <div style="margin-top:6px">${escapeHtml(p.address||'')}</div>
        </div>
      `});
      m.addListener('click', ()=>iw.open({anchor:m, map:gMap}));
      gMarkers.push(m);
      bounds.extend(m.getPosition());
    });
    if(!bounds.isEmpty()) gMap.fitBounds(bounds);
  }

  // –∫–ª–∏–∫ ¬´–ù–∞ –∫–∞—Ä—Ç–µ¬ª –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏
  function focusOnMap(lat, lng, place){
    openMap();
    // –¥–æ–∂–¥—ë–º—Å—è –∏ —Å—Ñ–æ–∫—É—Å–∏—Ä—É–µ–º
    setTimeout(()=>{
      if(gMap && lat && lng){
        gMap.setCenter({lat, lng}); gMap.setZoom(16);
      }
    }, 350);
  }

  // –ó–∞–≥–ª—É—à–∫–∏: –º–æ–¥–∞–ª–∫–∏ ¬´–û –∫–æ–º–ø–∞–Ω–∏–∏ / –ò–Ω–≤–µ—Å—Ç–æ—Ä–∞–º / –ü–∞—Ä—Ç–Ω—ë—Ä—É¬ª
  function openAbout(){ alert('SEO-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ ¬´–û –∫–æ–º–ø–∞–Ω–∏–∏¬ª –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ.'); }
  function openInvest(){ alert('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤/—Å–ø–æ–Ω—Å–æ—Ä–æ–≤ ‚Äî –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ.'); }
  function openPartner(){ alert('–ê–Ω–∫–µ—Ç–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞ —É–∂–µ –±—ã–ª–∞ ‚Äî –ø–æ–¥–∫–ª—é—á–∏–º —Å—é–¥–∞ –ø–æ–∑–∂–µ (–∏–ª–∏ –æ—Ç–∫—Ä–æ–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π).'); }
</script>
</body>
</html>

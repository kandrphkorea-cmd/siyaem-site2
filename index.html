<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SiyaEm Korea ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞</title>
  <meta name="description" content="–ö–∞—Ç–∞–ª–æ–≥ –∏ –ø—Ä–æ–º–æ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π –≤ –ö–æ—Ä–µ–µ: –µ–¥–∞, —Å–∞–ª–æ–Ω—ã, –º–µ—Ö–∞–Ω–∏–∫–∏, —Å–µ—Ä–≤–∏—Å—ã.">

  <style>
    :root{
      --brand:#2563eb;          /* –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏–Ω–∏–π */
      --brand-2:#60a5fa;        /* —Å–≤–µ—Ç–ª—ã–π –∞–∫—Ü–µ–Ω—Ç */
      --gold:#f59e0b;           /* –∑–æ–ª–æ—Ç–æ (–±–µ–π–¥–∂/–∑–≤–µ–∑–¥—ã) */
      --ok:#10b981;             /* –∑–µ–ª—ë–Ω—ã–π */
      --danger:#ef4444;         /* –∫—Ä–∞—Å–Ω—ã–π */
      --bg:#0f172a;             /* —Ñ–æ–Ω —Ç—ë–º–Ω–æ–π */
      --bg-soft:#0b1221;        /* –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç—ë–º–Ω–æ–π */
      --txt:#e5e7eb;            /* —Ç–µ–∫—Å—Ç —Ç—ë–º–Ω–æ–π */
      --muted:#94a3b8;          /* –≤—Ç–æ—Ä–∏—á–Ω—ã–π —Ç—ë–º–Ω–æ–π */
      --ring:rgba(59,130,246,.35);
      --rad:16px;
      --shadow:0 10px 28px rgba(2,8,23,.12), 0 2px 6px rgba(2,8,23,.08);
      --chip:#1f2a44;
    }
    [data-theme="light"]{
      --bg:#f7fbff;
      --bg-soft:#ffffff;
      --txt:#0f172a;
      --muted:#64748b;
      --chip:#e9eef8;
      --shadow:0 10px 26px rgba(2,8,23,.06), 0 2px 5px rgba(2,8,23,.05);
    }

    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#eef5ff,#f7fbff 35% 65%, #eef3fb);color:var(--txt);font:16px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    header{position:sticky;top:0;z-index:30;backdrop-filter:blur(10px);border-bottom:1px solid rgba(2,8,23,.07)}
    header .bar{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.2px}
    .brand-bullet{width:10px;height:10px;border-radius:50%;background:var(--gold);box-shadow:0 0 16px var(--gold)}
    .menu{display:flex;gap:8px;flex-wrap:wrap}
    .btn{cursor:pointer;border:1px solid rgba(2,8,23,.1);background:var(--bg-soft);padding:10px 14px;border-radius:12px}
    .btn:hover{border-color:var(--brand-2)}
    .btn-primary{background:var(--brand);color:#fff;border-color:transparent}
    .btn-primary:hover{filter:brightness(1.05)}
    .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:13px}
    .filters{background:var(--bg-soft);border-radius:var(--rad);box-shadow:var(--shadow);padding:14px;border:1px solid rgba(2,8,23,.06);display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .select, input[type="search"]{width:100%;background:#fff;border:1px solid rgba(2,8,23,.12);border-radius:12px;padding:10px 12px;outline:0}
    [data-theme="dark"] .select, [data-theme="dark"] input[type="search"]{background:#0b1221;color:#e5e7eb;border-color:#1f2937}
    .ads-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:14px}
    .ad{position:relative;background:var(--bg-soft);border-radius:18px;overflow:hidden;box-shadow:var(--shadow);border:1px solid rgba(2,8,23,.08)}
    .ad img{width:100%;height:280px;object-fit:cover;display:block}
    .ad .tag{position:absolute;left:12px;top:12px;background:rgba(255,255,255,.85);color:#0f172a;border-radius:999px;padding:6px 10px;font-size:12px;border:1px solid rgba(2,8,23,.08)}
    [data-theme="dark"] .ad .tag{background:rgba(2,8,23,.85);color:#cbd5e1;border-color:#1f2937}
    section.card{background:var(--bg-soft);border-radius:var(--rad);box-shadow:var(--shadow);border:1px solid rgba(2,8,23,.06);padding:16px;margin-top:18px}

    /* –ø–∞—Ä—Ç–Ω—ë—Ä—ã */
    .partners{display:grid;gap:12px}
    .partner{display:grid;grid-template-columns:68px 1fr auto;gap:12px;padding:12px;border-radius:14px;border:1px solid rgba(2,8,23,.08);background:linear-gradient(180deg,rgba(37,99,235,.03),transparent 35%)}
    [data-theme="dark"] .partner{background:linear-gradient(180deg,rgba(37,99,235,.12),transparent 35%)}
    .partner .logo{width:68px;height:68px;border-radius:12px;display:grid;place-items:center;background:#0b1221;color:#fff}
    [data-theme="light"] .partner .logo{background:#eef3ff;color:#0f172a}
    .partner h4{margin:0 0 4px 0;font-size:16px;display:flex;align-items:center;gap:8px}
    .badges{display:inline-flex;gap:6px;flex-wrap:wrap}
    .badge{font-size:11px;background:#fff;border:1px solid rgba(2,8,23,.08);padding:4px 8px;border-radius:999px;color:#64748b}
    [data-theme="dark"] .badge{background:#0b1221;border-color:#1f2937;color:#9ca3af}
    .meta{font-size:13px;color:var(--muted)}
    .p-actions{display:flex;gap:8px;align-items:center}
    .star{color:#fbbf24;font-size:16px}
    .stars{display:inline-flex;gap:2px;vertical-align:middle}
    .fav{cursor:pointer;font-size:18px;line-height:0;color:#ef4444;opacity:.85}
    .fav.active{filter:drop-shadow(0 0 8px rgba(239,68,68,.4))}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}

    /* –º–æ–¥–∞–ª–∫–∏ */
    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(2,6,23,.6);backdrop-filter:blur(6px);z-index:50}
    .modal.show{display:grid}
    .box{width:min(720px,calc(100vw - 28px));max-height:80vh;overflow:auto;background:var(--bg-soft);border:1px solid rgba(2,8,23,.12);border-radius:18px;padding:16px}
    .box h3{margin:0 0 8px}
    .field{display:flex;flex-direction:column;gap:6px;margin:8px 0}
    textarea,input[type="text"],input[type="tel"]{background:#fff;border:1px solid rgba(2,8,23,.12);border-radius:12px;padding:10px 12px;outline:none}
    [data-theme="dark"] textarea,[data-theme="dark"] input[type="text"],[data-theme="dark"] input[type="tel"]{background:#0b1221;color:#e5e7eb;border-color:#1f2937}
    .center{display:flex;justify-content:center;gap:10px;flex-wrap:wrap}
    footer{padding:28px 0 40px;text-align:center;color:var(--muted)}

    /* —Ñ–∞–∫—Ç—ã –∏ –Ω–∏–∂–Ω—è—è –ø—Ä–æ–º–æ-—Å–µ—Ç–∫–∞ */
    .facts{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .fact{background:var(--bg-soft);border:1px solid rgba(2,8,23,.06);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
    .ads-bottom{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}

    /* –º–∏–Ω–∏-–∏–∫–æ–Ω–∫–∏ */
    .ico{width:18px;height:18px;display:inline-block;vertical-align:-3px}
    .ico-food{filter:hue-rotate(300deg)}
    .ico-salon{filter:hue-rotate(30deg)}
    .ico-mech{filter:hue-rotate(180deg)}
    .ico-ent{filter:hue-rotate(90deg)}
    .tiny{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>

<header>
  <div class="wrap bar">
    <div class="brand"><span class="brand-bullet"></span> SiyaEm Korea</div>
    <div class="menu">
      <button class="btn" data-open="#about">–û –Ω–∞—Å</button>
      <button class="btn" data-open="#services">–£—Å–ª—É–≥–∏</button>
      <button class="btn" id="themeToggle">–°–≤–µ—Ç–ª–∞—è/–¢—ë–º–Ω–∞—è</button>
      <button class="btn" id="langToggle">RU</button>
      <button class="btn-primary" data-open="#partnerGate">–°—Ç–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º</button>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- –§–∏–ª—å—Ç—Ä—ã -->
  <section class="filters">
    <select id="fProvince" class="select">
      <option value="">–ü—Ä–æ–≤–∏–Ω—Ü–∏—è (–≤—Å–µ)</option>
    </select>
    <select id="fCity" class="select">
      <option value="">–ì–æ—Ä–æ–¥ (–≤—Å–µ)</option>
    </select>
    <select id="fCategory" class="select">
      <option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–≤—Å–µ)</option>
      <option>–ï–¥–∞ üçú</option>
      <option>–°–∞–ª–æ–Ω—ã üíÖ</option>
      <option>–ê–≤—Ç–æ–º–µ—Ö–∞–Ω–∏–∫–∏ üîß</option>
      <option>–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è üéØ</option>
      <option>–£—Å–ª—É–≥–∏ üß∞</option>
    </select>
    <button id="applyFilters" class="btn">–ü–æ–∫–∞–∑–∞—Ç—å</button>
  </section>

  <!-- –í–µ—Ä—Ö–Ω–∏–µ –ø—Ä–æ–º–æ-–∫–∞—Ä—Ç–æ—á–∫–∏ -->
  <div class="ads-grid">
    <div class="ad"><span class="tag">–†–µ–∫–ª–∞–º–∞ ‚Äî —Å–ª–æ—Ç #1</span>
      <img src="https://images.unsplash.com/photo-1521017432531-fbd92d4566b6?q=80&w=1200&auto=format&fit=crop" alt="">
    </div>
    <div class="ad"><span class="tag">–†–µ–∫–ª–∞–º–∞ ‚Äî —Å–ª–æ—Ç #2</span>
      <img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop" alt="">
    </div>
    <div class="ad"><span class="tag">–†–µ–∫–ª–∞–º–∞ ‚Äî —Å–ª–æ—Ç #3</span>
      <img src="https://images.unsplash.com/photo-1470337458703-46ad1756a187?q=80&w=1200&auto=format&fit=crop" alt="">
    </div>
  </div>

  <!-- –ü–∞—Ä—Ç–Ω—ë—Ä—ã -->
  <section class="card">
    <div class="chip">–ü–∞—Ä—Ç–Ω—ë—Ä—ã (–º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ)</div>
    <div id="partnersList" class="partners" style="margin-top:12px"></div>
  </section>

  <!-- –§–∞–∫—Ç—ã –∏ –ø–æ–ª–µ–∑–Ω—ã–µ –±–ª–æ–∫–∏ -->
  <section class="card">
    <div class="facts">
      <div class="fact">
        <div class="chip">–ê –≤—ã –∑–Ω–∞–ª–∏?</div>
        <div id="factText" style="margin-top:10px"></div>
        <div class="tiny" id="factSrc" style="margin-top:6px"></div>
      </div>
      <div class="fact">
        <div class="chip">–î–ª—è —Å–ø–æ–Ω—Å–æ—Ä–æ–≤</div>
        <p style="margin-top:10px">–†–µ–∫–ª–∞–º–Ω—ã–µ –±–ª–æ–∫–∏ 3√ó —Å–≤–µ—Ä—Ö—É –∏ 3√ó —Å–Ω–∏–∑—É (–∞–¥–∞–ø—Ç–∏–≤). –í–æ–∑–º–æ–∂–Ω–∞ –≥–µ–æ-—Ç–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ –ø–æ –ø—Ä–æ–≤–∏–Ω—Ü–∏—è–º –∏ –≥–æ—Ä–æ–¥–∞–º.</p>
        <div class="row">
          <button class="btn" data-open="#contacts">–°–≤—è–∑–∞—Ç—å—Å—è</button>
          <button class="btn-primary" data-open="#partnerGate">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å —Ä–µ–∫–ª–∞–º—É</button>
        </div>
      </div>
    </div>
  </section>

  <!-- –ù–∏–∂–Ω–∏–µ –ø—Ä–æ–º–æ-–∫–∞—Ä—Ç–æ—á–∫–∏ -->
  <section class="card">
    <div class="ads-bottom">
      <div class="ad"><span class="tag">–ü—Ä–æ–º–æ</span>
        <img src="https://images.unsplash.com/photo-1541542684-4a4c2c9533cc?q=80&w=1200&auto=format&fit=crop" alt="">
      </div>
      <div class="ad"><span class="tag">–ü—Ä–æ–º–æ</span>
        <img src="https://images.unsplash.com/photo-1504754524776-8f4f37790ca0?q=80&w=1200&auto=format&fit=crop" alt="">
      </div>
      <div class="ad"><span class="tag">–ü—Ä–æ–º–æ</span>
        <img src="https://images.unsplash.com/photo-1488459716781-31db52582fe9?q=80&w=1200&auto=format&fit=crop" alt="">
      </div>
    </div>
  </section>
</main>

<footer>¬© 2025 SiyaEm Korea. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</footer>

<!-- –ú–û–î–ê–õ–ö–ò -->
<div class="modal" id="about">
  <div class="box">
    <h3>–û –Ω–∞—Å</h3>
    <p>–ú—ã —Å–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ <b>–ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</b> —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –ö–æ—Ä–µ–µ –∏ –º–æ–¥–µ—Ä–∏—Ä—É–µ–º –∫–∞–∂–¥—É—é –∑–∞—è–≤–∫—É. –ù–∞—à–∞ —Ü–µ–ª—å ‚Äî —É–¥–æ–±–Ω—ã–π –∏ —á–µ—Å—Ç–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ ¬´—Ä—è–¥–æ–º —Å –≤–∞–º–∏¬ª.</p>
    <div class="center"><button class="btn-primary" data-close>–ü–æ–Ω—è—Ç–Ω–æ</button></div>
  </div>
</div>

<div class="modal" id="services">
  <div class="box">
    <h3>–£—Å–ª—É–≥–∏</h3>
    <ul>
      <li>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–π –∏ –º–æ–¥–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫</li>
      <li>–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –∏ —Å–æ—Ü—Å–µ—Ç—è—Ö</li>
      <li>–§–æ—Ç–æ/–≤–∏–¥–µ–æ-–∫–æ–Ω—Ç–µ–Ω—Ç –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</li>
      <li>–ü–∞–∫–µ—Ç—ã –¥–ª—è —Å–ø–æ–Ω—Å–æ—Ä–æ–≤ –∏ –≥–æ—Ä–æ–¥—Å–∫–∏—Ö –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤</li>
    </ul>
    <div class="center"><button class="btn-primary" data-close>–û–∫</button></div>
  </div>
</div>

<div class="modal" id="contacts">
  <div class="box">
    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
    <p>–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–æ—Ä–µ—è, Ï∂©ÎÇ® ÏïÑÏÇ∞Ïãú ÎëîÌè¨Î©¥<br/>Email: support@siyaem.kr</p>
    <div class="center"><button class="btn-primary" data-close>–ó–∞–∫—Ä—ã—Ç—å</button></div>
  </div>
</div>

<!-- –ì–µ–π—Ç: –≥–æ—Å—Ç—å / –ø–∞—Ä—Ç–Ω—ë—Ä -->
<div class="modal" id="partnerGate">
  <div class="box">
    <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.</p>
    <div class="center">
      <button class="btn-primary" id="enterGuest">–ó–∞–π—Ç–∏ –∫–∞–∫ –≥–æ—Å—Ç—å</button>
      <button class="btn" data-open="#partnerForm">–°—Ç–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º</button>
    </div>
  </div>
</div>

<!-- –ê–Ω–∫–µ—Ç–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞ (–∑–∞–≥–ª—É—à–∫–∞, –±–µ–∑ –±—ç–∫–∞) -->
<div class="modal" id="partnerForm">
  <div class="box">
    <h3>–ê–Ω–∫–µ—Ç–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞</h3>
    <p class="tiny">* –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–∑–∂–µ; –ø–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º email.</p>
    <div class="field">
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
      <input id="pfName" type="text" placeholder="–ù–∞–ø—Ä.: Mr. Cook" />
    </div>
    <div class="field">
      <label>Email / Kakao / –¢–µ–ª–µ—Ñ–æ–Ω</label>
      <input id="pfContact" type="text" placeholder="–ö–æ–Ω—Ç–∞–∫—Ç –¥–ª—è —Å–≤—è–∑–∏" />
    </div>
    <div class="field">
      <label>–ö–æ—Ä–æ—Ç–∫–æ –æ –º–µ—Å—Ç–µ</label>
      <textarea id="pfDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ, –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –∞–¥—Ä–µ—Å"></textarea>
    </div>
    <div class="center">
      <button class="btn-primary" id="pfSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button class="btn" data-close>–û—Ç–º–µ–Ω–∞</button>
    </div>
    <div id="pfResult" class="tiny" style="margin-top:8px;color:var(--ok);display:none">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ú—ã —Å–≤—è–∂–µ–º—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á.</div>
  </div>
</div>

<!-- –û—Ç–∑—ã–≤ -->
<div class="modal" id="reviewModal">
  <div class="box">
    <h3 id="revTitle">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h3>
    <div class="field">
      <label>–û—Ü–µ–Ω–∫–∞</label>
      <div id="revStars" class="stars"></div>
    </div>
    <div class="field">
      <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
      <textarea id="revText" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–∏"></textarea>
    </div>
    <div class="center">
      <button class="btn-primary" id="revSend">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="btn" data-close>–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>
</div>

<!-- –ß–∞—Ç -->
<div class="modal" id="chatModal">
  <div class="box">
    <h3 id="chatTitle">–ß–∞—Ç</h3>
    <div id="chatList" style="border:1px solid rgba(2,8,23,.12);border-radius:12px;padding:10px;max-height:40vh;overflow:auto;margin-bottom:10px"></div>
    <div class="row">
      <input id="chatMsg" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1" />
      <button class="btn-primary" id="chatSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
    <div class="center" style="margin-top:8px">
      <button class="btn" data-close>–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>
</div>

<script>
/* ======= –£–¢–ò–õ–´ ======= */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const LS = (k,v)=> (v===undefined? JSON.parse(localStorage.getItem(k)||'null') : localStorage.setItem(k,JSON.stringify(v)));
const THEME_KEY = 'siyaem_theme';
const LANG_KEY  = 'siyaem_lang';
const GUEST_KEY = 'siyaem_gate';
const RATING_KEY= id => `rate_${id}`;
const FAV_KEY   = 'fav_places';
const CHAT_KEY  = id => `chat_${id}`;

/* ======= –¢–ï–ú–ê / –Ø–ó–´–ö ======= */
(function initTheme(){
  const theme = LS(THEME_KEY) || 'light';
  document.documentElement.setAttribute('data-theme', theme);
  $('#themeToggle').onclick = ()=>{
    const t = document.documentElement.getAttribute('data-theme')==='light' ? 'dark':'light';
    document.documentElement.setAttribute('data-theme', t);
    LS(THEME_KEY, t);
  };
})();
(function initLang(){
  const lang = LS(LANG_KEY)||'RU';
  $('#langToggle').textContent = lang;
  $('#langToggle').onclick = ()=>{
    const nv = ({RU:'EN',EN:'KO',KO:'RU'})[ $('#langToggle').textContent ];
    $('#langToggle').textContent = nv; LS(LANG_KEY,nv);
  };
})();

/* ======= –ú–û–î–ê–õ–ö–ò ======= */
$$('[data-open]').forEach(b=>b.addEventListener('click',()=>{ $(`${b.getAttribute('data-open')}`).classList.add('show'); }));
$$('[data-close]').forEach(b=>b.addEventListener('click',()=>{ b.closest('.modal').classList.remove('show'); }));
$$('.modal').forEach(m=>m.addEventListener('click',(e)=>{ if(e.target===m) m.classList.remove('show'); }));

/* –ì–ï–ô–¢ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ */
(function gate(){
  if(LS(GUEST_KEY)) return;
  $('#partnerGate').classList.add('show');
  $('#enterGuest').onclick=()=>{ LS(GUEST_KEY,true); $('#partnerGate').classList.remove('show'); };
})();

/* –ê–Ω–∫–µ—Ç–∞ (–∑–∞–≥–ª—É—à–∫–∞) */
$('#pfSend').onclick = ()=>{
  $('#pfResult').style.display='block';
  setTimeout(()=>$('#partnerForm').classList.remove('show'),1400);
};

/* ======= –§–ê–ö–¢–´ ======= */
const facts = [
  {t:'–°–∞–º—ã–π –¥–ª–∏–Ω–Ω—ã–π –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—ë—Ç –∫—É—Ä–∏—Ü—ã ‚Äî –æ–∫–æ–ª–æ 13 —Å–µ–∫—É–Ω–¥. –î–∞, —ç—Ç–æ –ø—Ä–∞–≤–¥–∞!', s:'fun fact'},
  {t:'–ü–µ—Ä–≤—ã–µ –ø–∞–ª–æ—á–∫–∏ –¥–ª—è –µ–¥—ã –ø–æ—è–≤–∏–ª–∏—Å—å –≤ –ö–∏—Ç–∞–µ –±–æ–ª–µ–µ 3000 –ª–µ—Ç –Ω–∞–∑–∞–¥.', s:'history of food'},
  {t:'–ö–æ—Ñ–µ ‚Äî –≤—Ç–æ—Ä–æ–π –ø–æ –æ–±–æ—Ä–æ—Ç—É —Ç–æ–≤–∞—Ä –≤ –º–∏—Ä–µ –ø–æ—Å–ª–µ –Ω–µ—Ñ—Ç–∏.', s:'coffee stats'},
  {t:'–í –∫–∏–º—á–∏ –±–æ–ª–µ–µ 100 —Ä–∞–∑–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç–µ–π, –∏ —É –∫–∞–∂–¥–æ–π ‚Äî —Å–≤–æ–π —Å–µ–∑–æ–Ω.', s:'kimchi'}
];
(function rotateFacts(i=0){
  const f = facts[i%facts.length];
  $('#factText').textContent = f.t;
  $('#factSrc').textContent = f.s;
  setTimeout(()=>rotateFacts(i+1), 7000);
})();

/* ======= –ü–û–î–ì–†–£–ó–ö–ê –ü–ê–†–¢–ù–Å–†–û–í ======= */
let partners = [];
let filtered  = [];
const favs = new Set(LS(FAV_KEY)||[]);

async function loadPartners(){
  try{
    const res = await fetch('partners.json', {cache:'no-cache'});
    partners = (await res.json()).filter(x=>x.approved===true);
  }catch(e){
    // fallback
    partners = [{
      id:'mr_cook',
      name:'–ú–∏—Å—Ç–µ—Ä –ö—É–∫ (Mr. Cook)',
      category:'–ï–¥–∞',
      subcategories:['–ö–æ—Ä–µ–π—Å–∫–∞—è –∫—É—Ö–Ω—è','–°—Ç–æ–ª–æ–≤–∞—è'],
      rating:4.6,
      province_ru:'–ß—Ö—É–Ω—á—Ö–æ–Ω–Ω–∞–º-–¥–æ',
      city_ru:'–ê—Å–∞–Ω-—Å–∏, –î–æ–Ω–ø–æ-–º—ë–Ω',
      address:'405-20 Dunpo-ri, Dunpo-myeon, Asan-si, Chungcheongnam-do',
      lat:36.9305, lng:127.0458
    }];
  }
  fillFilters();
  applyFilters();
}
loadPartners();

/* ======= –§–ò–õ–¨–¢–†–´ ======= */
function fillFilters(){
  const prov = new Set(partners.map(p=>p.province_ru).filter(Boolean));
  const city = new Set(partners.map(p=>p.city_ru).filter(Boolean));
  prov.forEach(v => $('#fProvince').insertAdjacentHTML('beforeend', `<option>${v}</option>`));
  city.forEach(v => $('#fCity').insertAdjacentHTML('beforeend', `<option>${v}</option>`));
}
$('#applyFilters').onclick = applyFilters;

function applyFilters(){
  const p = $('#fProvince').value;
  const c = $('#fCity').value;
  const k = $('#fCategory').value.replace(/ .*/,''); // —Ç–æ–ª—å–∫–æ —Å–ª–æ–≤–æ
  filtered = partners.filter(x=>
     (!p || x.province_ru===p) &&
     (!c || x.city_ru===c) &&
     (!k || (x.category||'').includes(k))
  );
  renderPartners();
}

/* ======= –†–ï–ù–î–ï–† ======= */
function starRow(v, size=16){
  const n = Math.round((v||0)*2)/2;
  let s=''; for(let i=1;i<=5;i++){
    if(i<=Math.floor(n)) s+=`<span class="star">‚òÖ</span>`;
    else if(i-.5===n)  s+=`<span class="star" style="opacity:.6">‚òÖ</span>`;
    else               s+=`<span class="star" style="opacity:.25">‚òÖ</span>`;
  }
  return `<span class="stars" style="font-size:${size}px">${s}</span>`;
}

function renderPartners(){
  const el = $('#partnersList'); el.innerHTML='';
  if(!filtered.length){ el.innerHTML='<div class="tiny">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º</div>'; return; }

  filtered.forEach(p=>{
    const rid = LS(RATING_KEY(p.id))||{avg:p.rating||0,count: p.rating?1:0};
    const topPick = (rid.avg>=4.5 && rid.count>=3) ? `<span class="badge" title="–í—ã—Å–æ–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥">–í—ã–±–æ—Ä SiyaEm üèÜ</span>`:'';
    const favAct = favs.has(p.id) ? 'active' : '';
    const cat = (p.category||'') + (p.subcategories?.length? ' ‚Äî '+p.subcategories.join(', '):'');

    el.insertAdjacentHTML('beforeend', `
      <div class="partner" data-id="${p.id}">
        <div class="logo">üè∑Ô∏è</div>
        <div>
          <h4>${p.name} ${topPick}</h4>
          <div class="meta">${p.province_ru||''} ‚Ä¢ ${p.city_ru||''}</div>
          <div class="meta">${cat}</div>
          <div class="meta">${p.address||''}</div>
          <div class="row" style="align-items:center">
            ${starRow(rid.avg)} <span class="tiny">(${rid.count})</span>
          </div>
        </div>
        <div class="p-actions">
          <button class="btn" data-review>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
          <button class="btn" data-map>–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</button>
          <button class="btn" data-route>–ú–∞—Ä—à—Ä—É—Ç</button>
          <div class="fav ${favAct}" title="–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" data-fav>‚ù§</div>
          <button class="btn" data-chat>–ß–∞—Ç</button>
        </div>
      </div>
    `);
  });

  // –Ω–∞–≤–µ—Å–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
  $$('#partnersList [data-review]').forEach(b=>b.onclick=()=>openReview(b));
  $$('#partnersList [data-map]').forEach(b=>b.onclick=()=>openMap(b));
  $$('#partnersList [data-route]').forEach(b=>b.onclick=()=>openRoute(b));
  $$('#partnersList [data-chat]').forEach(b=>b.onclick=()=>openChat(b));
  $$('#partnersList [data-fav]').forEach(b=>b.onclick=()=>toggleFav(b));
}

function partnerByBtn(btn){
  const id = btn.closest('.partner').getAttribute('data-id');
  return filtered.find(x=>x.id===id) || partners.find(x=>x.id===id);
}

/* ======= –û–¢–ó–´–í–´ ======= */
function openReview(btn){
  const p = partnerByBtn(btn);
  $('#revTitle').textContent = `–û—Ç–∑—ã–≤: ${p.name}`;
  $('#reviewModal').classList.add('show');
  // –≥–µ–Ω–µ—Ä–∏–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –∑–≤—ë–∑–¥—ã
  const row = $('#revStars'); row.innerHTML='';
  for(let i=1;i<=5;i++){
    const s = document.createElement('span'); s.textContent='‚òÖ'; s.className='star';
    s.style.cursor='pointer'; s.dataset.v=i;
    s.onclick = ()=>{ row.querySelectorAll('.star').forEach((x,j)=>x.style.opacity = (j<i)?1:.3 ); row.dataset.score=i; };
    row.appendChild(s);
  }
  $('#revText').value='';
  $('#revSend').onclick = ()=>{
    const score = +($('#revStars').dataset.score||0);
    const memo  = LS(RATING_KEY(p.id)) || {avg:p.rating||0,count: p.rating?1:0};
    if(score>0){
      const total = memo.avg*memo.count + score;
      memo.count += 1; memo.avg = +(total/memo.count).toFixed(2);
      LS(RATING_KEY(p.id), memo);
      applyFilters();
    }
    $('#reviewModal').classList.remove('show');
  };
}

/* ======= –ò–ó–ë–†–ê–ù–ù–û–ï ======= */
function toggleFav(b){
  const p = partnerByBtn(b);
  if(favs.has(p.id)) favs.delete(p.id); else favs.add(p.id);
  LS(FAV_KEY, Array.from(favs));
  b.classList.toggle('active');
}

/* ======= –ö–ê–†–¢–ê / –ú–ê–†–®–†–£–¢ ======= */
function openMap(btn){
  const p = partnerByBtn(btn);
  const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.address||p.name)}`;
  window.open(url,'_blank');
}
function openRoute(btn){
  const p = partnerByBtn(btn);
  const q = encodeURIComponent(`${p.name} ${p.address||''}`);
  const g = `https://www.google.com/maps/dir/?api=1&destination=${q}`;
  const k = `https://map.kakao.com/?q=${q}`;
  const n = `https://map.naver.com/v5/search/${q}`;
  const win = window.open('','_blank');
  win.document.write(`
    <meta charset="utf-8" />
    <title>–ú–∞—Ä—à—Ä—É—Ç</title>
    <div style="font-family:Inter,system-ui; padding:20px">
      <h3>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä</h3>
      <p><a href="${g}" target="_self">Google Maps</a></p>
      <p><a href="${k}" target="_self">Kakao Map</a></p>
      <p><a href="${n}" target="_self">Naver Map</a></p>
    </div>`);
}

/* ======= –ß–ê–¢ ======= */
let currentChatId = null;
function openChat(btn){
  const p = partnerByBtn(btn);
  currentChatId = p.id;
  $('#chatTitle').textContent = `–ß–∞—Ç: ${p.name}`;
  renderChat();
  $('#chatModal').classList.add('show');
}
function renderChat(){
  const list = $('#chatList'); list.innerHTML='';
  const msgs = LS(CHAT_KEY(currentChatId))||[];
  msgs.forEach(m=>{
    list.insertAdjacentHTML('beforeend', `
      <div style="margin:8px 0; ${m.me?'text-align:right':''}">
        <div style="display:inline-block;background:${m.me?'var(--brand)':'var(--chip)'};color:${m.me?'#fff':'inherit'};padding:8px 10px;border-radius:12px;max-width:75%">${m.text}</div>
      </div>
    `);
  });
  list.scrollTop = list.scrollHeight;
}
$('#chatSend').onclick = ()=>{
  const t = $('#chatMsg').value.trim(); if(!t) return;
  const key = CHAT_KEY(currentChatId);
  const msgs = LS(key)||[]; msgs.push({me:true,text:t,ts:Date.now()});
  LS(key,msgs); $('#chatMsg').value='';
  renderChat();
};

/* ======= –°–¢–ê–†–¢ ======= */
</script>
</body>
</html>

<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SiyaEm Korea — проверенные места</title>
  <style>
    /* ===== БАЗА ТЕМЫ ===== */
    :root{
      --bg:#f6f8fc;
      --surface:#ffffff;
      --text:#0b1221;
      --muted:#6b7280;
      --brand:#2563eb;
      --border:#e5e7eb;

      --pill-bg:#eff3ff;
      --pill-bd:#dbe6ff;
      --pill-tx:#26407a;

      --star-on:#f59e0b;
      --star-off:#cbd5e1;

      --card-grad-1:#f5f9ff;
      --card-grad-2:#ffffff;
    }
    [data-theme="dark"]{
      --bg:#0b1221;
      --surface:#0f172a;
      --text:#e5e7eb;
      --muted:#94a3b8;
      --brand:#60a5fa;
      --border:#1f2937;

      --pill-bg:#0f1a35;
      --pill-bd:#20325e;
      --pill-tx:#cfe1ff;

      --star-on:#ffd166;
      --star-off:#475569;

      --card-grad-1:#0f1830;
      --card-grad-2:#0e1528;
    }

    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;z-index:30;background:rgba(255,255,255,.7);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}
    [data-theme="dark"] header{background:rgba(15,23,42,.55)}
    .nav{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .dot{width:10px;height:10px;border-radius:50%;background:#fbbf24;box-shadow:0 0 12px #fbbf24}
    .menu{display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--border);background:var(--surface);color:var(--text);
      padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;transition:.15s;
    }
    .btn:hover{filter:brightness(1.03)}
    .btn-primary{background:var(--brand);border-color:transparent;color:#fff}
    .btn-ghost{background:transparent}

    .card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:16px}
    h1,h2{margin:0 0 10px}
    .muted{color:var(--muted);font-size:14px}

    /* ===== ПРОМО КАРТОЧКИ (3 сверху/снизу) ===== */
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .ad-card{
      border-radius:16px;overflow:hidden;position:relative;border:1px solid var(--border);
      background:linear-gradient(var(--surface),var(--surface)) padding-box,
                 linear-gradient(135deg,#7aa2ff,#5cc2ff) border-box;
    }
    [data-theme="dark"] .ad-card{
      background:linear-gradient(var(--surface),var(--surface)) padding-box,
                 linear-gradient(135deg,#6ea8ff,#93c5fd) border-box;
    }
    .ad-card img{width:100%;height:230px;object-fit:cover;display:block}
    .ad-card::after{content:"";position:absolute;inset:-1px;border-radius:16px;pointer-events:none;box-shadow:0 10px 28px rgba(30,64,175,.15)}

    /* ===== КАТЕГОРИИ-ПИЛЮЛИ ===== */
    .cat-row{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 14px}
    .cat-pill{
      padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:700;
      background:var(--pill-bg);border:1px solid var(--pill-bd);color:var(--pill-tx);user-select:none;transition:.15s;
    }
    .cat-pill:hover{filter:brightness(1.04)}
    .cat-pill.active{background:linear-gradient(135deg,#7aa2ff,#5cc2ff);border-color:transparent;color:#fff}

    /* ===== ПАРТНЁРЫ ===== */
    .partner-card2{
      display:grid;grid-template-columns:72px 1fr;gap:16px;
      background:linear-gradient(180deg,var(--card-grad-1),var(--card-grad-2) 45%);
      border:1px solid var(--border);border-radius:16px;padding:14px 16px;
      box-shadow:0 6px 16px rgba(59,130,246,.06);
    }
    .partner-avatar2{
      width:72px;height:72px;border-radius:16px;overflow:hidden;
      background:linear-gradient(135deg,#3b82f6,#60a5fa);
      display:grid;place-items:center;color:#fff;font-weight:900
    }
    .partner-avatar2 img{width:100%;height:100%;object-fit:cover}
    .partner-title2{margin:0;font-weight:900}
    .partner-sub2{margin:4px 0 6px;color:var(--muted);font-size:13px}
    .partner-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .stars-wrap{display:inline-flex;gap:2px;align-items:center}
    .star{font-size:18px;cursor:pointer;color:var(--star-off);transition:.15s}
    .star.on{color:var(--star-on);transform:scale(1.04)}
    .stars-hint{color:var(--muted);font-size:12px;margin-left:6px}

    /* ===== КАРТА ===== */
    #map{height:440px;border-radius:16px;overflow:hidden;border:1px solid var(--border)}
  </style>
</head>
<body>

  <header>
    <div class="wrap nav">
      <div class="brand"><span class="dot"></span><span>SiyaEm Korea</span></div>
      <div class="menu">
        <button class="btn-ghost btn" data-scroll="#topPromo">Главная</button>
        <button class="btn-ghost btn" data-scroll="#partners">Партнёры</button>
        <button class="btn-ghost btn" data-scroll="#mapBox">Карта</button>
        <button id="themeToggle" class="btn">День / Ночь</button>
      </div>
    </div>
  </header>

  <main class="wrap">

    <!-- ВЕРХНИЙ ПРОМО-БЛОК (3 карточки) -->
    <section class="card" id="topPromo">
      <h1>Проверенные русскоязычные места</h1>
      <p class="muted">Отображаем только заведения, которые прошли ручную модерацию и подтвердили лицензию.</p>
      <div class="grid-3" style="margin-top:10px">
        <div class="ad-card"><img src="https://images.unsplash.com/photo-1555396273-367ea4eb4db5?q=80&w=1200&auto=format&fit=crop" alt=""></div>
        <div class="ad-card"><img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1200&auto=format&fit=crop" alt=""></div>
        <div class="ad-card"><img src="https://images.unsplash.com/photo-1485872299829-7a37d1b3eeec?q=80&w=1200&auto=format&fit=crop" alt=""></div>
      </div>
    </section>

    <!-- ПАРТНЁРЫ -->
    <section class="card" id="partners" style="margin-top:14px">
      <h2>Партнёры (модерировано)</h2>

      <!-- Категории -->
      <div class="cat-row" id="catRow">
        <div class="cat-pill active" data-cat="">Все</div>
        <div class="cat-pill" data-cat="Еда">Еда</div>
        <div class="cat-pill" data-cat="Салоны">Салоны</div>
        <div class="cat-pill" data-cat="Автомеханика">Автомеханика</div>
        <div class="cat-pill" data-cat="Развлечения">Развлечения</div>
        <div class="cat-pill" data-cat="Такси">Такси</div>
        <div class="cat-pill" data-cat="Другое">Другое</div>
      </div>

      <div id="partnersList" style="display:grid;gap:12px"></div>
    </section>

    <!-- КАРТА -->
    <section class="card" id="mapBox" style="margin-top:14px">
      <h2>Карта</h2>
      <div id="map"></div>
    </section>

    <!-- НИЖНИЙ ПРОМО-БЛОК -->
    <section class="card" style="margin-top:14px">
      <h2>Галерея / Промо</h2>
      <div class="grid-3" style="margin-top:10px">
        <div class="ad-card"><img src="https://images.unsplash.com/photo-1528605248644-14dd04022da1?q=80&w=1200&auto=format&fit=crop" alt=""></div>
        <div class="ad-card"><img src="https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?q=80&w=1200&auto=format&fit=crop" alt=""></div>
        <div class="ad-card"><img src="https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=1200&auto=format&fit=crop" alt=""></div>
      </div>
    </section>

  </main>

  <footer class="wrap" style="padding:22px 16px;color:var(--muted)">
    © 2025 SiyaEm Korea. Все права защищены.
  </footer>

  <!-- ===== JS: ТЕМА, СКРОЛЛ ===== -->
  <script>
    // Переключатель светлая/тёмная
    const themeBtn = document.getElementById('themeToggle');
    function setTheme(t){ document.documentElement.setAttribute('data-theme',t); localStorage.setItem('siyaem_theme',t); }
    const saved = localStorage.getItem('siyaem_theme') || 'light'; setTheme(saved);
    themeBtn.addEventListener('click', ()=> setTheme(document.documentElement.getAttribute('data-theme')==='light'?'dark':'light'));

    // Плавный скролл по кнопкам меню
    document.querySelectorAll('[data-scroll]').forEach(b=>{
      b.addEventListener('click', ()=>{
        const sel = b.getAttribute('data-scroll');
        const el = document.querySelector(sel);
        if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
      });
    });
  </script>

  <!-- ===== JS: ПАРТНЁРЫ, КАТЕГОРИИ, ЗВЁЗДЫ, КАРТА ===== -->
  <script>
    // Глобальная мапа маркеров для "Показать на карте"
    const MARKERS = new Map();
    let MAP;

    // Инициализация Google Maps
    function initMap(){
      MAP = new google.maps.Map(document.getElementById('map'),{
        center:{lat:36.9305, lng:127.0458},
        zoom:14,
        mapTypeControl:false,
        streetViewControl:false,
        fullscreenControl:false
      });
      // Когда партнёры загрузятся — добавим маркеры
      if(window.PARTNERS_DATA?.length) addMarkers(window.PARTNERS_DATA);
    }
    function addMarkers(list){
      MARKERS.clear();
      list.forEach(p=>{
        if(typeof p.lat!=='number'||typeof p.lng!=='number') return;
        const m = new google.maps.Marker({
          position:{lat:p.lat,lng:p.lng}, map:MAP, title:p.name
        });
        const info = new google.maps.InfoWindow({
          content:`<div style="min-width:220px"><b>${p.name}</b><br>${p.address||''}</div>`
        });
        m.addListener('click',()=> info.open({anchor:m, map:MAP}));
        MARKERS.set(p.id, m);
      });
    }
    function showOnMapById(id){
      const m = MARKERS.get(id);
      if(!m || !MAP) return alert('Маркер ещё не готов');
      MAP.panTo(m.getPosition());
      MAP.setZoom(17);
      google.maps.event.trigger(m,'click');
    }

    // Категории/фильтр
    let activeCat = "";
    let PARTNERS_DATA = [];
    const ratingKey = id => `siyaem_rating_${id}`;
    const getRating = id => +(localStorage.getItem(ratingKey(id))||0);
    const setRating = (id,val)=> localStorage.setItem(ratingKey(id), String(val));

    function renderCard(p){
      const my = getRating(p.id);
      const stars = [1,2,3,4,5].map(n=>`<span class="star ${n<= (my || p.rating || 0) ? 'on':''}" data-star="${n}" title="${n}/5">★</span>`).join('');
      return `
        <div class="partner-card2" data-id="${p.id}" data-category="${p.category}">
          <div class="partner-avatar2">
            ${p.photo ? `<img src="${p.photo}" alt="${p.name}">` : (p.name?.[0]||'S')}
          </div>
          <div>
            <h3 class="partner-title2">${p.name}</h3>
            <div class="partner-sub2">${p.province_ru||''} • ${p.city_ru||''} · ${p.category||''}${p.subcategories?.length ? ' — '+p.subcategories.join(', ') : ''}</div>
            <div class="stars-wrap" data-stars-for="${p.id}">
              ${stars}<span class="stars-hint">(ваша оценка сохраняется локально)</span>
            </div>
            <div class="partner-actions">
              <button class="btn btn-primary" data-open="#review">Оставить отзыв</button>
              <button class="btn btn-ghost" data-onmap="${p.id}">Показать на карте</button>
            </div>
            <div style="margin-top:6px;color:var(--muted);font-size:12px">${p.address||''}</div>
          </div>
        </div>`;
    }

    function renderList(){
      const host = document.getElementById('partnersList');
      const filtered = activeCat ? PARTNERS_DATA.filter(x=>x.category===activeCat) : PARTNERS_DATA;
      host.innerHTML = filtered.map(renderCard).join('') || `<div class="partner-sub2">Пока нет заведений в этой категории.</div>`;

      // Навесить звёзды
      host.querySelectorAll('.stars-wrap').forEach(w=>{
        const pid = w.getAttribute('data-stars-for');
        w.addEventListener('click', e=>{
          const s = e.target.closest('.star'); if(!s) return;
          const val = +s.getAttribute('data-star'); setRating(pid,val);
          w.querySelectorAll('.star').forEach(el=>{
            const n = +el.getAttribute('data-star'); el.classList.toggle('on', n<=val);
          });
        });
      });
      // Кнопки показать на карте
      host.querySelectorAll('[data-onmap]').forEach(b=>{
        b.addEventListener('click', ()=> showOnMapById(b.getAttribute('data-onmap')));
      });

      // Перестроить маркеры
      if(MAP) addMarkers(filtered);
    }

    // Категории клики
    (function initCat(){
      const row = document.getElementById('catRow');
      row.addEventListener('click', e=>{
        const pill = e.target.closest('.cat-pill'); if(!pill) return;
        row.querySelectorAll('.cat-pill').forEach(p=>p.classList.remove('active'));
        pill.classList.add('active');
        activeCat = pill.getAttribute('data-cat') || "";
        renderList();
      });
    })();

    // Загрузка partners.json + fallback
    (async function loadPartners(){
      let data;
      try{
        const r = await fetch('partners.json',{cache:'no-cache'});
        if(!r.ok) throw new Error('no json');
        data = await r.json();
      }catch(e){
        // Fallback: один партнёр — Мистер Кук
        data = [{
          "id":"mr_cook",
          "name":"Мистер Кук (Mr. Cook)",
          "category":"Еда",
          "subcategories":["Корейская кухня","Столовая"],
          "rating":4.6,
          "province_ru":"Чхунчхоннам-до",
          "city_ru":"Асан-си, Донпо-мён",
          "address":"405-20 Dunpo-ri, Dunpo-myeon, Asan-si, Chungcheongnam-do",
          "lat":36.9305,
          "lng":127.0458,
          "approved":true
        }];
      }
      PARTNERS_DATA = (data||[]).filter(x=>x.approved);
      window.PARTNERS_DATA = PARTNERS_DATA; // чтобы initMap смог добавить маркеры
      renderList();
    })();
  </script>

  <!-- Google Maps (ключ вставлен) -->
  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfroP4Q7_yFpEMPXgDMn-bohk1xRxTkro&callback=initMap&loading=async"></script>
</body>
</html>

<!doctype html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SiyaEm Korea ‚Äî —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –ö–æ—Ä–µ–µ</title>
  <meta name="description" content="–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π –≤ –ö–æ—Ä–µ–µ: –µ–¥–∞, —Å–∞–ª–æ–Ω—ã, —Å–µ—Ä–≤–∏—Å—ã. –ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ –∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ." />

  <style>
    /* ---------------- THEME ---------------- */
    :root{
      --bg:#0f172a; --bg-2:#111827; --text:#e5e7eb; --muted:#94a3b8;
      --line:#1f2937; --acc:#2563eb; --acc-2:#fbbf24; --ok:#10b981; --danger:#ef4444;
      --card:rgba(17,24,39,.85); --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.25)
    }
    html[data-theme="light"]{
      --bg:#f6f8fc; --bg-2:#ffffff; --text:#0b1221; --muted:#51607c;
      --line:#dbe1f0; --card:#ffffff; --shadow:0 6px 24px rgba(32,62,152,.1)
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),var(--bg-2) 30% 70%,var(--bg));
      color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:inherit}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    .glass{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
    .row{display:grid;gap:16px}
    @media(min-width:900px){ .row-2{grid-template-columns:1fr 1fr} .row-3{grid-template-columns:1fr 1fr 1fr} }

    /* ---------------- HEADER ---------------- */
    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(12px);
      background:color-mix(in oklab, var(--bg) 70%, transparent);
      border-bottom:1px solid var(--line)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--acc-2);box-shadow:0 0 14px var(--acc-2)}
    .menu{display:flex;gap:10px;flex-wrap:wrap}
    .btn{
      appearance:none;border:none;cursor:pointer;border-radius:12px;padding:10px 14px;
      color:var(--text);background:transparent;border:1px solid var(--line);font-weight:700
    }
    .btn:hover{border-color:color-mix(in lch, var(--acc), white 20%)}
    .btn-primary{background:var(--acc);border-color:var(--acc);color:#fff}
    .btn-primary:hover{filter:brightness(1.05)}
    .btn-pill{border-radius:999px}
    .switch{display:flex;gap:8px;align-items:center}

    /* ---------------- HERO ---------------- */
    .hero{padding:24px}
    .title{font-size:28px;margin:0 0 8px}
    .muted{color:var(--muted)}
    .filters{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .input, select{
      background:color-mix(in oklab, var(--bg-2) 70%, #0000); color:var(--text);
      border:1px solid var(--line); border-radius:12px; padding:10px 12px; outline:none
    }
    .input:focus, select:focus{border-color:var(--acc)}

    /* ---------------- ADS ---------------- */
    .ads{padding:16px}
    .ad{position:relative;overflow:hidden;border-radius:14px;min-height:140px}
    .ad img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.05)}
    .ad .badge{position:absolute;left:12px;top:12px;background:rgba(0,0,0,.35);padding:6px 10px;border-radius:999px;color:#fff;border:1px solid #ffffff40}

    /* ---------------- LIST ---------------- */
    .card{padding:16px}
    .list{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:900px){ .list{grid-template-columns:1fr 1fr} }
    .place{display:flex;gap:14px;border:1px solid var(--line);border-radius:14px;padding:12px}
    .place .logo{flex:0 0 64px;height:64px;border-radius:10px;background:#0b1221;display:grid;place-items:center;color:#cde}
    html[data-theme="light"] .place .logo{background:#eef3ff;color:#345}
    .stars{color:#f59e0b}
    .mini{font-size:12px;color:var(--muted)}
    .actions{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}

    /* ---------------- MODALS ---------------- */
    .modal{position:fixed;inset:0;display:none;place-items:center;z-index:20;background:rgba(3,6,23,.55);backdrop-filter:blur(6px)}
    .modal.show{display:grid}
    .box{width:min(880px,calc(100vw - 28px));max-height:85vh;overflow:auto;padding:18px;background:var(--card);border:1px solid var(--line);border-radius:18px}
    .grid-2{display:grid;gap:12px}
    @media(min-width:900px){ .grid-2{grid-template-columns:1fr 1fr} }
    textarea{min-height:110px;resize:vertical}

    /* ---------------- FOOTER ---------------- */
    footer{padding:34px 0;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand"><span class="dot"></span><span>SiyaEm Korea</span></div>
      <div class="menu">
        <button class="btn" data-open="#about">–û –Ω–∞—Å</button>
        <button class="btn" data-open="#services">–£—Å–ª—É–≥–∏</button>
        <button class="btn" id="openMapBtn">–ö–∞—Ä—Ç–∞</button>
        <div class="switch">
          <button class="btn btn-pill" id="guestBtn">–í–æ–π—Ç–∏ –∫–∞–∫ –≥–æ—Å—Ç—å</button>
          <button class="btn btn-primary btn-pill" data-open="#partner">–°—Ç–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º</button>
          <button class="btn btn-pill" id="themeBtn">üåô/‚òÄÔ∏è</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- HERO -->
    <section class="hero glass">
      <h1 class="title">–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –ö–æ—Ä–µ–µ</h1>
      <p class="muted">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—à–ª–∏ —Ä—É—á–Ω—É—é –º–æ–¥–µ—Ä–∞—Ü–∏—é –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ –ª–∏—Ü–µ–Ω–∑–∏—é.</p>

      <!-- –§–ò–õ–¨–¢–†–´ -->
      <div class="filters">
        <select id="fProvince" title="–ü—Ä–æ–≤–∏–Ω—Ü–∏—è">
          <option value="">–ü—Ä–æ–≤–∏–Ω—Ü–∏—è ‚Äî –≤—Å–µ</option>
        </select>
        <select id="fCity" title="–ì–æ—Ä–æ–¥">
          <option value="">–ì–æ—Ä–æ–¥ ‚Äî –≤—Å–µ</option>
        </select>
        <select id="fCategory" title="–ö–∞—Ç–µ–≥–æ—Ä–∏—è">
          <option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è ‚Äî –≤—Å–µ</option>
        </select>
        <button class="btn btn-primary" id="applyFilters">–ü–æ–∫–∞–∑–∞—Ç—å</button>
      </div>
    </section>

    <!-- –†–ï–ö–õ–ê–ú–ê / –ë–ê–ù–ù–ï–†–´ -->
    <section class="ads glass" style="margin-top:16px">
      <div class="row row-3">
        <a class="ad" href="#" target="_blank">
          <img src="https://images.unsplash.com/photo-1528605248644-14dd04022da1?q=80&w=1600&auto=format&fit=crop" alt="">
          <span class="badge">–†–µ–∫–ª–∞–º–∞ ¬∑ —Å–ª–æ—Ç #1</span>
        </a>
        <a class="ad" href="#" target="_blank">
          <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1600&auto=format&fit=crop" alt="">
          <span class="badge">–†–µ–∫–ª–∞–º–∞ ¬∑ —Å–ª–æ—Ç #2</span>
        </a>
        <a class="ad" href="#" target="_blank">
          <img src="https://images.unsplash.com/photo-1554080353-a576cf803bda?q=80&w=1600&auto=format&fit=crop" alt="">
          <span class="badge">–†–µ–∫–ª–∞–º–∞ ¬∑ —Å–ª–æ—Ç #3</span>
        </a>
      </div>
    </section>

    <!-- –°–ü–ò–°–û–ö –ü–ê–†–¢–ù–ï–†–û–í -->
    <section class="card glass" style="margin-top:16px">
      <h3 style="margin:0 0 12px">–ü–∞—Ä—Ç–Ω—ë—Ä—ã (–º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ)</h3>
      <div class="list" id="partnersList"></div>
      <div class="mini" id="emptyMsg" style="display:none;margin-top:6px">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.</div>
    </section>

    <!-- –ï—â—ë –±–ª–æ–∫–∏ –ø–æ–¥ –¥–ª–∏–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <section class="glass card" style="margin-top:16px">
      <h3 style="margin:0 0 12px">–ü—Ä–æ–º–æ / –ì–∞–ª–µ—Ä–µ—è</h3>
      <div class="row row-3">
        <img class="glass" style="width:100%;border-radius:12px" src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?q=80&w=1400&auto=format&fit=crop" alt="">
        <img class="glass" style="width:100%;border-radius:12px" src="https://images.unsplash.com/photo-1511690656952-34342bb7c2f2?q=80&w=1400&auto=format&fit=crop" alt="">
        <img class="glass" style="width:100%;border-radius:12px" src="https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?q=80&w=1400&auto=format&fit=crop" alt="">
      </div>
      <p class="mini" style="margin-top:8px">–≠—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –±–∞–Ω–Ω–µ—Ä—ã –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤.</p>
    </section>
  </main>

  <footer>¬© 2025 SiyaEm Korea. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</footer>

  <!-- MODALS -->
  <div class="modal" id="about"><div class="box">
    <h3>–û –∫–æ–º–ø–∞–Ω–∏–∏</h3>
    <p class="muted">SiyaEm ‚Äî —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –ö–æ—Ä–µ–µ. –ú—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞ –∫–∞—Ä—Ç—É –∏ –ø–æ–º–æ–≥–∞–µ–º —Å –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ–º.</p>
    <div style="margin-top:10px"><button class="btn btn-primary" data-close>–û–∫</button></div>
  </div></div>

  <div class="modal" id="services"><div class="box">
    <h3>–£—Å–ª—É–≥–∏</h3>
    <ul>
      <li>–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—Ü–µ–Ω–∑–∏–π</li>
      <li>–ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ –∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö</li>
      <li>–§–æ—Ç–æ/–≤–∏–¥–µ–æ-–∫–æ–Ω—Ç–µ–Ω—Ç –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫</li>
    </ul>
    <div style="margin-top:10px"><button class="btn btn-primary" data-close>–û–∫</button></div>
  </div></div>

  <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≥–æ—Å—Ç—è -->
  <div class="modal" id="guestAuth"><div class="box">
    <h3>–í–æ–π—Ç–∏ –∫–∞–∫ –≥–æ—Å—Ç—å</h3>
    <div class="grid-2">
      <div>
        <label>–ò–º—è*</label>
        <input class="input" id="gName" placeholder="–ò–º—è" required>
      </div>
      <div>
        <label>–¢–µ–ª–µ—Ñ–æ–Ω/Email*</label>
        <input class="input" id="gContact" placeholder="+82-10-.... –∏–ª–∏ email" required>
      </div>
    </div>
    <p class="mini muted">–î–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞: –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫–∏ –∏ –ø–∏—Å–∞—Ç—å –æ—Ç–∑—ã–≤—ã.</p>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn btn-primary" id="guestSave">–í–æ–π—Ç–∏</button>
      <button class="btn" data-close>–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div></div>

  <!-- –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ -->
  <div class="modal" id="reviewModal"><div class="box">
    <h3 id="revTitle">–û—Ç–∑—ã–≤</h3>
    <div>
      <label>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞</label><br>
      <div id="revStars" style="font-size:22px;color:#f59e0b;cursor:pointer">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      <input type="hidden" id="revScore" value="5">
    </div>
    <div style="margin-top:8px">
      <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
      <textarea class="input" id="revText" placeholder="–ß—Ç–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å? –ß—Ç–æ —É–ª—É—á—à–∏—Ç—å?"></textarea>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn btn-primary" id="revSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button class="btn" data-close>–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div></div>

  <!-- –ö–∞—Ä—Ç–∞ -->
  <div class="modal" id="mapModal"><div class="box">
    <h3>–ö–∞—Ä—Ç–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤</h3>
    <div id="map" style="height:520px;border-radius:12px;border:1px solid var(--line)"></div>
    <div style="margin-top:10px"><button class="btn" data-close>–ó–∞–∫—Ä—ã—Ç—å</button></div>
  </div></div>

  <!-- –ê–Ω–∫–µ—Ç–∞ –ø–∞—Ä—Ç–Ω—ë—Ä–∞ (–∫–∞–∫ –±—ã–ª–æ) -->
  <div class="modal" id="partner"><div class="box">
    <h3>–°—Ç–∞—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º</h3>
    <p class="muted">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –ø—Ä–∏–ª–æ–∂–∏—Ç–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ ‚Äî –º—ã –ø—Ä–æ–≤–µ—Ä–∏–º –∏ –¥–æ–±–∞–≤–∏–º –Ω–∞ –∫–∞—Ä—Ç—É.</p>
    <div class="grid-2">
      <input class="input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è*" />
      <input class="input" placeholder="–ì–æ—Ä–æ–¥, –ø—Ä–æ–≤–∏–Ω—Ü–∏—è*" />
      <input class="input" placeholder="–ê–¥—Ä–µ—Å (–∫–∞–∫ –≤ –ª–∏—Ü–µ–Ω–∑–∏–∏)*" />
      <input class="input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏*" />
    </div>
    <p class="mini">–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Äî ¬´–Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ 10‚Äì60 –º–∏–Ω—É—Ç¬ª. –†–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ —Å—Ç–∞—Ç–∏—á–Ω—É—é –≤–µ—Ä—Å–∏—é.</p>
    <div style="margin-top:10px"><button class="btn btn-primary" data-close>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></div>
  </div></div>

  <!-- ============ JS ============ -->
  <script>
    /* ---------------- THEME ---------------- */
    const themeBtn = document.getElementById('themeBtn');
    const savedTheme = localStorage.getItem('siya_theme');
    if(savedTheme) document.documentElement.setAttribute('data-theme', savedTheme);
    themeBtn.onclick = ()=>{
      const cur = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', cur);
      localStorage.setItem('siya_theme', cur);
    };

    /* ---------------- MODALS ---------------- */
    document.querySelectorAll('[data-open]').forEach(b=>{
      b.onclick = ()=> document.querySelector(b.dataset.open).classList.add('show');
    });
    document.querySelectorAll('[data-close]').forEach(b=>{
      b.onclick = ()=> b.closest('.modal').classList.remove('show');
    });
    document.querySelectorAll('.modal').forEach(m=>{
      m.addEventListener('click', e=>{ if(e.target===m) m.classList.remove('show'); });
    });

    /* ---------------- GUEST AUTH ---------------- */
    const guestBtn = document.getElementById('guestBtn');
    const guest = JSON.parse(localStorage.getItem('siya_guest')||'null');
    function setGuestUI() {
      const g = JSON.parse(localStorage.getItem('siya_guest')||'null');
      guestBtn.textContent = g ? `–ì–æ—Å—Ç—å: ${g.name}` : '–í–æ–π—Ç–∏ –∫–∞–∫ –≥–æ—Å—Ç—å';
    }
    setGuestUI();
    guestBtn.onclick = ()=> document.getElementById('guestAuth').classList.add('show');
    document.getElementById('guestSave').onclick = ()=>{
      const name = document.getElementById('gName').value.trim();
      const contact = document.getElementById('gContact').value.trim();
      if(!name || !contact) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω/email.');
      localStorage.setItem('siya_guest', JSON.stringify({name, contact}));
      setGuestUI();
      document.getElementById('guestAuth').classList.remove('show');
    };

    /* ---------------- DATA ---------------- */
    let RAW = [];      // –∏–∑ partners.json
    let FILTERED = []; // –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    let MAP = null, MAP_MARKERS = [];

    async function loadPartners(){
      // partners.json –¥–æ–ª–∂–µ–Ω –ª–µ–∂–∞—Ç—å —Ä—è–¥–æ–º —Å index.html –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (—É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å)
      const res = await fetch('partners.json', {cache:'no-cache'});
      RAW = await res.json();
      buildFilters();
      applyFilters();
    }

    function buildFilters(){
      const prov = new Set(), city = new Set(), cat = new Set();
      RAW.forEach(x=>{
        if(x.approved) {
          if(x.province_ru) prov.add(x.province_ru);
          if(x.city_ru) city.add(x.city_ru);
          if(x.category) cat.add(x.category);
        }
      });
      fillSelect('fProvince', prov);
      fillSelect('fCity', city);
      fillSelect('fCategory', cat);
    }
    function fillSelect(id, set){
      const sel = document.getElementById(id);
      [...set].sort().forEach(v=>{
        const o = document.createElement('option'); o.value = v; o.textContent = v; sel.appendChild(o);
      });
    }

    function applyFilters(){
      const p = document.getElementById('fProvince').value;
      const c = document.getElementById('fCity').value;
      const k = document.getElementById('fCategory').value;
      FILTERED = RAW.filter(x=> x.approved
        && (!p || x.province_ru===p)
        && (!c || x.city_ru===c)
        && (!k || x.category===k));
      renderList();
    }
    document.getElementById('applyFilters').onclick = applyFilters;

    /* ---------------- LIST RENDER ---------------- */
    function avgRating(id){
      const arr = JSON.parse(localStorage.getItem('siya_rates_'+id)||'[]');
      if(!arr.length) return {avg:0,count:0};
      const avg = arr.reduce((s,x)=>s+x.score,0)/arr.length;
      return {avg, count:arr.length};
    }
    function starsHTML(val){
      const n = Math.round(val*2)/2; // –ø–æ–ª–æ–≤–∏–Ω–∫–∏
      const full = Math.floor(n), half = n-full;
      return '‚òÖ'.repeat(full) + (half? '¬Ω':'') + '‚òÜ'.repeat(5-full-(half?1:0));
    }
    function renderList(){
      const box = document.getElementById('partnersList');
      box.innerHTML = '';
      document.getElementById('emptyMsg').style.display = FILTERED.length? 'none':'block';
      FILTERED.forEach(p=>{
        const r = avgRating(p.id);
        const el = document.createElement('div');
        el.className = 'place';
        el.innerHTML = `
          <div class="logo">üè∑Ô∏è</div>
          <div style="flex:1">
            <div style="display:flex;justify-content:space-between;gap:8px;align-items:center">
              <div><b>${p.name}</b><div class="mini">${p.province_ru} ‚Ä¢ ${p.city_ru}</div></div>
              <div class="mini">${p.category}${p.subcategories?.length? ' ‚Äî '+p.subcategories.join(', '):''}</div>
            </div>
            <div class="mini" style="margin-top:4px">${p.address}</div>
            <div class="mini" style="margin-top:6px"><span class="stars">${'‚òÖ'.repeat(Math.round(r.avg))}${'‚òÜ'.repeat(5-Math.round(r.avg))}</span> <span class="mini">(${r.count})</span></div>
            <div class="actions">
              <button class="btn btn-primary" data-review="${p.id}">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
              <button class="btn" data-center="${p.id}">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</button>
            </div>
          </div>`;
        box.appendChild(el);
      });

      // bind actions
      box.querySelectorAll('[data-review]').forEach(b=>{
        b.onclick = ()=> openReview(b.dataset.review);
      });
      box.querySelectorAll('[data-center]').forEach(b=>{
        b.onclick = ()=> openMapAndCenter(b.dataset.center);
      });
    }

    /* ---------------- REVIEWS ---------------- */
    let currentReviewId = null;
    function openReview(id){
      if(!localStorage.getItem('siya_guest')){ document.getElementById('guestAuth').classList.add('show'); return; }
      currentReviewId = id;
      const p = RAW.find(x=>x.id===id);
      document.getElementById('revTitle').textContent = `–û—Ç–∑—ã–≤: ${p?.name||''}`;
      document.getElementById('reviewModal').classList.add('show');
    }
    // –∑–≤—ë–∑–¥—ã
    (()=>{
      const el = document.getElementById('revStars');
      const input = document.getElementById('revScore');
      const set = (n)=>{ input.value=n; el.textContent='‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ'.slice(0,n)+'‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ'.slice(n); };
      let cur=5; set(5);
      el.onmousemove = e=>{
        const w = el.clientWidth; const x = e.offsetX; const n = Math.min(5,Math.max(1, Math.ceil(x/(w/5))));
        if(n!==cur){ cur=n; set(n); }
      };
      el.onclick = ()=> set(cur);
    })();
    document.getElementById('revSend').onclick = ()=>{
      if(!currentReviewId) return;
      const guest = JSON.parse(localStorage.getItem('siya_guest'));
      const text = document.getElementById('revText').value.trim();
      const score = +document.getElementById('revScore').value;
      const key = 'siya_rates_'+currentReviewId;
      const arr = JSON.parse(localStorage.getItem(key)||'[]');
      arr.push({score, text, by:guest.name, ts:Date.now()});
      localStorage.setItem(key, JSON.stringify(arr));
      document.getElementById('reviewModal').classList.remove('show');
      document.getElementById('revText').value='';
      applyFilters(); // –æ–±–Ω–æ–≤–∏–º —Å—Ä–µ–¥–Ω—é—é
      alert('–°–ø–∞—Å–∏–±–æ! –û—Ç–∑—ã–≤ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –ª–æ–∫–∞–ª—å–Ω–æ (–¥–µ–º–æ). –ù–∞ –ø—Ä–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–∏–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä/—Ç–∞–±–ª–∏—Ü—É.');
    };

    /* ---------------- MAP ---------------- */
    const MAP_STYLES = [
      {featureType:"poi", stylers:[{visibility:"off"}]},
      {featureType:"poi.business", stylers:[{visibility:"off"}]},
      {featureType:"poi.medical", stylers:[{visibility:"off"}]},
      {featureType:"poi.school", stylers:[{visibility:"off"}]},
      {featureType:"poi.attraction", stylers:[{visibility:"off"}]}
    ];
    document.getElementById('openMapBtn').onclick = ()=> document.getElementById('mapModal').classList.add('show');

    async function ensureMaps(){
      if(window.google?.maps) return;
      // ====== –í–°–¢–ê–í–¨ –°–í–û–ô –ö–õ–Æ–ß –ù–ò–ñ–ï ======
      const KEY = 'AIzaSyBfroP4Q7_yFpEMPXgDMn-bohk1xRxTkro';
      // ====================================
      await new Promise((resolve, reject)=>{
        window.__gmInit = resolve;
        const s = document.createElement('script');
        s.src = `https://maps.googleapis.com/maps/api/js?key=${KEY}&callback=__gmInit`;
        s.async = true; s.onerror = ()=>reject(new Error('Maps failed'));
        document.head.appendChild(s);
      });
    }
    async function openMapAndCenter(id){
      document.getElementById('mapModal').classList.add('show');
      await drawMap();
      const p = RAW.find(x=>x.id===id);
      if(MAP && p){ MAP.setCenter({lat:p.lat, lng:p.lng}); MAP.setZoom(16); }
    }
    async function drawMap(){
      await ensureMaps();
      if(!MAP){
        MAP = new google.maps.Map(document.getElementById('map'),{
          center:{lat:36.9305, lng:127.0458}, zoom:14, styles:MAP_STYLES,
          fullscreenControl:false, streetViewControl:false, mapTypeControl:false
        });
      }
      MAP_MARKERS.forEach(m=>m.setMap(null)); MAP_MARKERS = [];
      RAW.filter(x=>x.approved).forEach(p=>{
        const m = new google.maps.Marker({position:{lat:p.lat,lng:p.lng}, map:MAP, title:p.name});
        const info = new google.maps.InfoWindow({content:`<b>${p.name}</b><br><small>${p.province_ru} ‚Ä¢ ${p.city_ru}</small><br>${p.address}`});
        m.addListener('click',()=>info.open({anchor:m, map:MAP}));
        MAP_MARKERS.push(m);
      });
    }
    // –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã–ª –º–æ–¥–∞–ª–∫—É –∫–∞—Ä—Ç—ã ‚Äî –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å (1 —Ä–∞–∑)
    document.getElementById('mapModal').addEventListener('transitionend', e=>{
      if(e.target.id==='mapModal' && e.target.classList.contains('show')) drawMap();
    });

    /* ---------------- INIT ---------------- */
    loadPartners();
  </script>

  <!-- ========= –ß–ê–¢ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ========= 
    –í—Å—Ç–∞–≤—å —Å—é–¥–∞ –∫–æ–¥ –≤–∏–¥–∂–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä tawk.to / chatbase).
    –ü—Ä–∏–º–µ—Ä (–∑–∞–º–µ–Ω–∏ PROPERTY_ID):
    <script type="text/javascript">
      var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
      (function(){var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
      s1.async=true;s1.src='https://embed.tawk.to/PROPERTY_ID/1';s1.charset='UTF-8';s1.setAttribute('crossorigin','*');
      s0.parentNode.insertBefore(s1,s0);})();
    </script>
  ======================================= -->
</body>
</html>
